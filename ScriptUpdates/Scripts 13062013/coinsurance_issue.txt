DECLARE 
V_AGN_CODE NUMBER;
CURSOR C1 IS
SELECT * FROM LMS_POLICY_COINSURERS;

BEGIN
    FOR C IN C1
    LOOP

        BEGIN
        SELECT AGN_CODE 
        INTO V_AGN_CODE
        FROM LMS_AGENCIES
        WHERE AGN_SHT_DESC=TO_CHAR(C.POL_COIN_AGN_CODE);
        EXCEPTION
        WHEN NO_DATA_FOUND THEN
        V_AGN_CODE :=0;
        END;
        
        IF V_AGN_CODE !=0 THEN
        
        UPDATE LMS_POLICY_COINSURERS
        SET POL_COIN_AGN_CODE=V_AGN_CODE
        WHERE POL_COIN_CODE=C.POL_COIN_CODE;

        UPDATE LMS_POLICY_COIN_MEM_COVERS
        SET PCMC_AGN_CODE=V_AGN_CODE
        WHERE PCMC_POL_COIN_CODE=C.POL_COIN_CODE;
        
        END IF;

    END LOOP;
    COMMIT;
END;
/